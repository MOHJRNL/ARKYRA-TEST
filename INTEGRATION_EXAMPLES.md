# Integration Usage Examples

## Video/Media Integrations

### HeyGen - AI Avatar Video

```typescript
import { ThirdPartyManager } from '@gitroom/nestjs-libraries/3rdparties/thirdparty.manager';

// In your service
async generateAvatarVideo() {
  const heygen = this.thirdPartyManager.getThirdPartyByName('heygen');

  const videoUrl = await heygen.instance.sendData(apiKey, {
    voice: 'Hello! Welcome to our platform.',
    avatar: 'josh_lite3_20230714',
    aspect_ratio: 'portrait',
    captions: 'yes',
    selectedVoice: 'en-US-JennyNeural',
    type: 'avatar',
  });

  return videoUrl;
}
```

### Synthesia - AI Video Creation

```typescript
async createSynthesiaVideo() {
  const synthesia = this.thirdPartyManager.getThirdPartyByName('synthesia');

  const videoUrl = await synthesia.instance.sendData(apiKey, {
    script: 'This is a professional video presentation.',
    avatar: 'anna_costume1_cameraA',
    voice: 'en-US-Neural2-A',
    background: '#FFFFFF',
  });

  return videoUrl;
}
```

### D-ID - Talking Photo

```typescript
async createTalkingPhoto() {
  const did = this.thirdPartyManager.getThirdPartyByName('d-id');

  const videoUrl = await did.instance.sendData(apiKey, {
    script: 'Hello from my photo!',
    source_url: 'https://example.com/photo.jpg',
    voice_id: 'en-US-JennyNeural',
  });

  return videoUrl;
}
```

### Runway - AI Video Generation

```typescript
async generateRunwayVideo() {
  const runway = this.thirdPartyManager.getThirdPartyByName('runway');

  const videoUrl = await runway.instance.sendData(apiKey, {
    prompt: 'A serene lake at sunset with mountains in the background',
    model: 'gen3a_turbo',
    duration: 5,
  });

  return videoUrl;
}
```

## Audio Integrations

### ElevenLabs - Realistic AI Voice

```typescript
async generateVoice() {
  const elevenlabs = this.thirdPartyManager.getThirdPartyByName('elevenlabs');

  const audioData = await elevenlabs.instance.sendData(apiKey, {
    text: 'This is a natural-sounding voice generated by AI.',
    voice_id: '21m00Tcm4TlvDq8ikWAM',
    model_id: 'eleven_monolingual_v1',
    voice_settings: {
      stability: 0.5,
      similarity_boost: 0.75,
    },
  });

  return audioData; // Returns base64-encoded audio
}
```

### Murf AI - Studio Quality Voiceover

```typescript
async generateMurfVoice() {
  const murf = this.thirdPartyManager.getThirdPartyByName('murf');

  const audioUrl = await murf.instance.sendData(apiKey, {
    text: 'Creating studio-quality voiceovers with AI.',
    voiceId: 'en-US-natalie',
    style: 'Conversational',
    rate: 0,
    pitch: 0,
  });

  return audioUrl;
}
```

### PlayHT - Ultra-Realistic Voice

```typescript
async generatePlayHTVoice() {
  const playht = this.thirdPartyManager.getThirdPartyByName('playht');

  // Note: API key format is "userId:apiKey"
  const audioUrl = await playht.instance.sendData(apiKey, {
    text: 'Ultra-realistic voice synthesis.',
    voice: 's3://voice-cloning-zero-shot/...',
    quality: 'premium',
    output_format: 'mp3',
    speed: 1,
  });

  return audioUrl;
}
```

## AI Integrations (Hybrid Router)

### Basic AI Completion with Auto-Fallback

```typescript
import { AIRouterService } from '@gitroom/nestjs-libraries/ai-router/services/ai-router.service';
import { AccuracyLevel } from '@gitroom/nestjs-libraries/ai-router/enums/accuracy-level.enum';
import { TaskType } from '@gitroom/nestjs-libraries/ai-router/enums/task-type.enum';

// In your service
constructor(private readonly aiRouter: AIRouterService) {}

async generateContent() {
  const response = await this.aiRouter.generateCompletion({
    prompt: 'Write a product description for eco-friendly water bottles',
    organizationId: 'org_123',
    accuracyLevel: AccuracyLevel.HIGH,
    taskType: TaskType.CONTENT_GENERATION,
    maxTokens: 500,
    temperature: 0.7,
  });

  console.log(`Content: ${response.content}`);
  console.log(`Provider: ${response.provider}`); // Could be GLM, OpenAI, Claude, or Mistral
  console.log(`Cost: $${response.estimatedCost}`);
  console.log(`Tokens: ${response.totalTokens}`);

  return response.content;
}
```

### Specific AI Provider (Claude)

```typescript
import { ClaudeProviderAdapter } from '@gitroom/nestjs-libraries/ai-router/providers/claude-provider.adapter';

async useClaudeSpecifically() {
  const response = await this.claudeProvider.generateCompletion({
    prompt: 'Analyze this complex business case...',
    systemMessage: 'You are a business analyst.',
    organizationId: 'org_123',
    accuracyLevel: AccuracyLevel.PREMIUM,
    taskType: TaskType.ANALYSIS,
    maxTokens: 4096,
  });

  return response;
}
```

### Structured Output with Claude

```typescript
async getStructuredData() {
  const result = await this.claudeProvider.generateStructuredOutput(
    'Extract key information from this text: [text here]',
    null, // schema (optional)
    {
      systemMessage: 'Return a JSON object with extracted data',
      temperature: 0.3,
    }
  );

  return result; // Returns parsed JSON
}
```

### Cost-Effective Content with Mistral

```typescript
async bulkContentGeneration() {
  const mistral = this.moduleRef.get(MistralProviderAdapter);

  const response = await mistral.generateCompletion({
    prompt: 'Generate 5 social media post ideas about sustainable living',
    organizationId: 'org_123',
    accuracyLevel: AccuracyLevel.STANDARD,
    taskType: TaskType.CONTENT_GENERATION,
  });

  return response.content;
}
```

## Automation Integrations

### Webhooks - Custom HTTP Endpoint

```typescript
async sendWebhook() {
  const webhooks = this.thirdPartyManager.getThirdPartyByName('webhooks');

  const result = await webhooks.instance.sendData(webhookUrl, {
    url: webhookUrl,
    method: 'POST',
    headers: {
      'X-Custom-Header': 'value',
    },
    body: {
      event: 'new_content',
      data: {
        title: 'New Post',
        content: 'Post content...',
      },
    },
  });

  return result;
}
```

### Zapier - Trigger Zap

```typescript
async triggerZapier() {
  const zapier = this.thirdPartyManager.getThirdPartyByName('zapier');

  const result = await zapier.instance.sendData(zapierWebhookUrl, {
    trigger: 'content_published',
    data: {
      title: 'New Article',
      url: 'https://example.com/article',
      author: 'John Doe',
      timestamp: new Date().toISOString(),
    },
  });

  return result;
}
```

### Make (Integromat) - Trigger Scenario

```typescript
async triggerMakeScenario() {
  const make = this.thirdPartyManager.getThirdPartyByName('make');

  const result = await make.instance.sendData(makeWebhookUrl, {
    scenario_id: 'scenario_123',
    data: {
      action: 'process_data',
      payload: {
        /* your data */
      },
    },
  });

  return result;
}
```

### n8n - Execute Workflow

```typescript
async executeN8nWorkflow() {
  const n8n = this.thirdPartyManager.getThirdPartyByName('n8n');

  const result = await n8n.instance.sendData(n8nWebhookUrl, {
    workflow_id: 'workflow_123',
    execution_mode: 'production',
    data: {
      task: 'generate_report',
      parameters: {
        /* your parameters */
      },
    },
  });

  return result;
}
```

## Content Source Integrations

### Notion - Query Database

```typescript
async getNotionData() {
  const notion = this.thirdPartyManager.getThirdPartyByName('notion');

  const records = await notion.instance.sendData(apiKey, {
    database_id: 'database_id_here',
    action: 'query',
    data: {
      filter: {
        property: 'Status',
        select: { equals: 'Published' },
      },
    },
  });

  return JSON.parse(records);
}
```

### Google Sheets - Read Data

```typescript
async readSheetData() {
  const sheets = this.thirdPartyManager.getThirdPartyByName('google-sheets');

  const data = await sheets.instance.sendData(apiKey, {
    spreadsheet_id: 'spreadsheet_id_here',
    range: 'Sheet1!A1:D10',
    action: 'read',
  });

  return JSON.parse(data);
}
```

### Google Sheets - Write Data

```typescript
async writeSheetData() {
  const sheets = this.thirdPartyManager.getThirdPartyByName('google-sheets');

  const result = await sheets.instance.sendData(apiKey, {
    spreadsheet_id: 'spreadsheet_id_here',
    range: 'Sheet1!A1',
    action: 'write',
    values: [
      ['Name', 'Email', 'Date'],
      ['John Doe', 'john@example.com', '2024-01-28'],
    ],
  });

  return result;
}
```

### Airtable - Get Records

```typescript
async getAirtableRecords() {
  const airtable = this.thirdPartyManager.getThirdPartyByName('airtable');

  const records = await airtable.instance.sendData(apiKey, {
    base_id: 'base_id_here',
    table_name: 'Content',
    action: 'list',
  });

  return JSON.parse(records);
}
```

### Airtable - Create Record

```typescript
async createAirtableRecord() {
  const airtable = this.thirdPartyManager.getThirdPartyByName('airtable');

  const record = await airtable.instance.sendData(apiKey, {
    base_id: 'base_id_here',
    table_name: 'Content',
    action: 'create',
    fields: {
      Title: 'New Article',
      Status: 'Draft',
      'Published Date': '2024-01-28',
    },
  });

  return record;
}
```

## Analytics Integrations

### Google Analytics 4 - Run Report

```typescript
async getGA4Data() {
  const ga4 = this.thirdPartyManager.getThirdPartyByName('ga4');

  const report = await ga4.instance.sendData(apiKey, {
    property_id: 'properties/123456789',
    date_range: {
      start_date: '30daysAgo',
      end_date: 'today',
    },
    metrics: ['activeUsers', 'screenPageViews'],
    dimensions: ['date', 'country'],
  });

  return JSON.parse(report);
}
```

### PostHog - Capture Event

```typescript
async trackPostHogEvent() {
  const posthog = this.thirdPartyManager.getThirdPartyByName('posthog');

  const result = await posthog.instance.sendData(apiKey, {
    action: 'capture_event',
    event_name: 'content_generated',
    distinct_id: 'user_123',
    properties: {
      content_type: 'article',
      word_count: 500,
      ai_model: 'gpt-4',
    },
  });

  return result;
}
```

### PostHog - Get Insights

```typescript
async getPostHogInsights() {
  const posthog = this.thirdPartyManager.getThirdPartyByName('posthog');

  const insights = await posthog.instance.sendData(apiKey, {
    action: 'get_insights',
  });

  return JSON.parse(insights);
}
```

### Amplitude - Track Event

```typescript
async trackAmplitudeEvent() {
  const amplitude = this.thirdPartyManager.getThirdPartyByName('amplitude');

  const result = await amplitude.instance.sendData(apiKey, {
    action: 'track_event',
    user_id: 'user_123',
    event_type: 'Video Generated',
    event_properties: {
      provider: 'heygen',
      duration: 30,
      quality: 'HD',
    },
  });

  return result;
}
```

## Advanced Examples

### Sequential Integration Pipeline

```typescript
async contentCreationPipeline() {
  // 1. Generate content with AI
  const content = await this.aiRouter.generateCompletion({
    prompt: 'Write about sustainable fashion',
    organizationId: 'org_123',
    accuracyLevel: AccuracyLevel.HIGH,
    taskType: TaskType.CONTENT_GENERATION,
  });

  // 2. Generate voice narration
  const elevenlabs = this.thirdPartyManager.getThirdPartyByName('elevenlabs');
  const audio = await elevenlabs.instance.sendData(elevenLabsKey, {
    text: content.content,
    voice_id: '21m00Tcm4TlvDq8ikWAM',
  });

  // 3. Create video with avatar
  const heygen = this.thirdPartyManager.getThirdPartyByName('heygen');
  const video = await heygen.instance.sendData(heygenKey, {
    voice: content.content,
    avatar: 'josh_lite3_20230714',
    aspect_ratio: 'portrait',
    captions: 'yes',
    selectedVoice: 'en-US-JennyNeural',
    type: 'avatar',
  });

  // 4. Save to Notion
  const notion = this.thirdPartyManager.getThirdPartyByName('notion');
  await notion.instance.sendData(notionKey, {
    database_id: 'database_id',
    action: 'create',
    data: {
      properties: {
        Title: { title: [{ text: { content: 'Sustainable Fashion Video' } }] },
        'Video URL': { url: video },
        'Audio URL': { url: audio },
      },
    },
  });

  // 5. Trigger Zapier for distribution
  const zapier = this.thirdPartyManager.getThirdPartyByName('zapier');
  await zapier.instance.sendData(zapierWebhook, {
    trigger: 'new_video',
    data: { video_url: video, title: 'Sustainable Fashion Video' },
  });

  return { content, audio, video };
}
```

### Parallel Processing with Multiple Providers

```typescript
async generateMultipleFormats() {
  const content = 'Your content here';

  // Process in parallel
  const [audio1, audio2, audio3] = await Promise.all([
    // ElevenLabs
    this.thirdPartyManager
      .getThirdPartyByName('elevenlabs')
      .instance.sendData(key1, { text: content, voice_id: 'voice1' }),

    // Murf
    this.thirdPartyManager
      .getThirdPartyByName('murf')
      .instance.sendData(key2, { text: content, voiceId: 'voice2' }),

    // PlayHT
    this.thirdPartyManager
      .getThirdPartyByName('playht')
      .instance.sendData(key3, { text: content, voice: 'voice3' }),
  ]);

  return { elevenlabs: audio1, murf: audio2, playht: audio3 };
}
```

### Error Handling and Retry

```typescript
async robustIntegrationCall() {
  const maxRetries = 3;
  let lastError;

  for (let i = 0; i < maxRetries; i++) {
    try {
      const heygen = this.thirdPartyManager.getThirdPartyByName('heygen');
      const result = await heygen.instance.sendData(apiKey, data);
      return result;
    } catch (error) {
      lastError = error;
      this.logger.warn(`Attempt ${i + 1} failed: ${error.message}`);

      if (i < maxRetries - 1) {
        // Exponential backoff
        await new Promise((resolve) =>
          setTimeout(resolve, Math.pow(2, i) * 1000)
        );
      }
    }
  }

  throw new Error(`All retries failed: ${lastError.message}`);
}
```

## Frontend Examples

### Using Integration in React Component

```typescript
import { useThirdPartyFunction, useThirdPartySubmit } from '@gitroom/frontend/components/third-parties/third-party.function';

function VideoGeneratorComponent() {
  const load = useThirdPartyFunction('EVERYTIME');
  const send = useThirdPartySubmit();

  async function generateVideo() {
    // Get avatars
    const avatars = await load('avatars');

    // Generate video
    const result = await send({
      voice: 'Hello world',
      avatar: avatars[0].avatar_id,
      aspect_ratio: 'portrait',
      captions: 'yes',
    });

    return result;
  }

  return <button onClick={generateVideo}>Generate Video</button>;
}
```

## Testing Examples

### Unit Test

```typescript
describe('IntegrationService', () => {
  it('should generate video with HeyGen', async () => {
    const result = await service.generateHeygenVideo({
      voice: 'Test message',
      avatar: 'test_avatar',
    });

    expect(result).toBeDefined();
    expect(result).toContain('https://');
  });
});
```

### Integration Test

```typescript
describe('Integration Pipeline', () => {
  it('should complete content pipeline', async () => {
    const result = await service.contentCreationPipeline();

    expect(result.content).toBeDefined();
    expect(result.audio).toBeDefined();
    expect(result.video).toBeDefined();
  });
});
```

## Performance Optimization

### Caching Results

```typescript
import { Cache } from '@nestjs/cache-manager';

async generateCachedContent() {
  const cacheKey = `ai_content_${prompt_hash}`;

  // Check cache first
  const cached = await this.cacheManager.get(cacheKey);
  if (cached) return cached;

  // Generate if not cached
  const result = await this.aiRouter.generateCompletion({...});

  // Cache for 1 hour
  await this.cacheManager.set(cacheKey, result, 3600);

  return result;
}
```

### Batch Processing

```typescript
async batchProcessContent(items: string[]) {
  const batchSize = 5;
  const results = [];

  for (let i = 0; i < items.length; i += batchSize) {
    const batch = items.slice(i, i + batchSize);
    const batchResults = await Promise.all(
      batch.map((item) => this.processItem(item))
    );
    results.push(...batchResults);

    // Rate limiting delay
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  return results;
}
```

## License

Part of the ARKYRA platform.
